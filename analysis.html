<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
	<meta charset="UTF-8">
	<!-- <script src="http://code.jquery.com/jquery-1.11.2.min.js"></script> -->
	<script src="js/jquery.js"></script>
	<script src="js/Chart.min.js"></script>
	<link href="css/my.css" rel="stylesheet">
	<title>IBM Big Data Challenge</title>
	<script>
 		var pieChartData = [
			//"Customer",1150379,"Subscriber",8574247
			{
		        value: 1150379,
		        color:"#F7464A",
		        highlight: "#FF5A5E",
		        label: "Customer"
		    },
		    {
		        value: 8574247,
		        color: "#46BFBD",
		        highlight: "#5AD3D1",
		        label: "Subscriber"
		    }
		];
		

		genderData = [
					//Customer -   "Male",83 	  "Unknown",1150282 "Female",14
					//Subscriber - "Male",6587739 "Unknown",926 	"Female",1985582
					{
				        value: 6587822,
				        color:"Blue",
				        highlight: "Blue",
				        label: "Male"
				    },
					{
				        value: 1985596,
				        color:"Deeppink",
				        highlight: "Deeppink",
				        label: "Female"
				    },
					{
				        value: 1151208,
				        color:"grey",
				        highlight: "darkgrey",
				        label: "Unknown"
				    }
		];
		
		subscriberData = [
					//"Male",6587739 "Unknown",1985582 "Female",926
					{
				        value: 6587739,
				        color:"Blue",
				        highlight: "Blue",
				        label: "Male"
				    },
					{
				        value: 1985582,
				        color:"Deeppink",
				        highlight: "Deeppink",
				        label: "Female"
				    },
					{
				        value: 926,
				        color:"grey",
				        highlight: "darkgrey",
				        label: "Unknown"
					}
		];
		
		customerData = [
					
					{
				        value: 83,
				        color:"Blue",
				        highlight: "Blue",
				        label: "Male"
				    },
					{
				        value: 14,
				        color:"Deeppink",
				        highlight: "Deeppink",
				        label: "Female"
				    },
					{
				        value: 1150282,
				        color:"grey",
				        highlight: "darkgrey",
				        label: "Unknown"
				    }
		];		
		
		tripCategories = [
			{
				label: "0-1000",
				value: 7098163,
				color:"violet",
			},
			{
				label: "1000-2000",
				value: 2158332,
				color:"blue",
			},
			{
				label: "2000-3000",
				value: 327115,
				color:"green",
			},
			{
				label: "3000-4000",
				value: 30091,
				color:"yellow",
			},
			{
				label: "4000-5000",
				value: 25400,
				color:"orange"
			},
			{
				label: "5000-8000",
				value: 30091,
				color:"red"
			},															
			{
				label: "8000-10000",
				value: 8418,
				color:"white"
			},	
			{
				label: "10000+",
				value: 17591,
				color:"chocolate"
			},					
		];	
				
		$(document).ready(function(){
		
			var ctx = document.getElementById("canvas").getContext("2d");
			createUserTypeDistributionPie();
			
			function createUserTypeDistributionPie() {
				renderPieChart(pieChartData);
				createTableForPieChart(pieChartData,"UserTypeDistribution");
				updateChartTitle("Customer Subscriber Distribution");
			}
			
			function createGenderDistributionPie() {
				renderPieChart(genderData);
				createTableForPieChart(genderData,"GenderDistribution");
				updateChartTitle("Gender Distribution");
			}			
			
			function createTripCategoriesPie() {
				renderPieChart(tripCategories);
				createTableForPieChart(tripCategories,"TripCategories");
				updateChartTitle("Trips By Duration (seconds)");
			}				
			
			function renderPieChart(pieChartData) {
				myPieChart = new Chart(ctx).Pie(pieChartData, {
					responsive : true,
					animateScale : true,
				});
			}
			
			canvas.onclick = function(evt){
		 		var activePoints = myPieChart.getSegmentsAtEvent(evt);
		 		console.log("label clicked " + activePoints[0].label);
		 		if("Customer" == activePoints[0].label) {
		 			myPieChart.destroy();
		 			console.log("Rendering gender distribution for Customers");
		 			renderPieChart(customerData);
					createTableForPieChart(customerData,"GenderDistribution");
					updateChartTitle("Gender Distribution For Customers");
		 		} else if("Subscriber" == activePoints[0].label)  {
		 			myPieChart.destroy();
		 			console.log("Rendering gender distribution for Subscriber");
		 			renderPieChart(subscriberData);
		 			createTableForPieChart(subscriberData,"GenderDistribution");
		 			updateChartTitle("Gender Distribution For Subscribers");
		 		} else {
		 			return;
		 		}
			};
			
			function createTableForPieChart(pieChartData,pieChartFor) {
				var tbody  = $('#chart-table > tbody');
				var rows = $('#chart-table > tbody > tr')
				console.log("rows.length" + rows.length);
				for(i=0;i<rows.length;i++) {
					rows[i].remove();
				}
				if(pieChartFor == "UserTypeDistribution") {
					tbody.append("<tr class='pie-table-header'><td>Key</td><td>User Type</td><td># of Trips</td></tr>");
				} else if(pieChartFor == "GenderDistribution") {
					tbody.append("<tr class='pie-table-header'><td>Key</td><td>Gender</td><td># of Trips</td></tr>");
				} else if(pieChartFor == "TripCategories") {
					tbody.append("<tr class='pie-table-header'><td>Key</td><td>Trip Duration (s)</td><td># of Trips</td></tr>");
				}
				
				console.log("elements in Pie Chart - " + pieChartData.length);
				for(i=0;i< pieChartData.length;i++) {
					title = pieChartData[i].label;
					value = pieChartData[i].value;
					color = pieChartData[i].color;
					tbody.append("<tr class='pie-table-row'><td><div class='colorbox' style='background-color:"+ color + 
					"'></div></td><td>"+title+"</td><td>"+value+"</td></tr>");
				}
			}
			
			function updateChartTitle(chartTitle) {
				$("#header > div").last().text(chartTitle);
			}
			
			$( "li" ).bind( "click", function() {
  				menu = $(this).text();
  				myPieChart.destroy();
  				if(menu == "Users") {
  					createUserTypeDistributionPie();
  				} else if(menu == "Genders") {
  					createGenderDistributionPie();
  				}  else if(menu == "Trips") {
  					createTripCategoriesPie();
  				}
			});
			
		});	 
	</script>
</head>
<body>
	<div id="container">
		<div id="header" class="header">
			<div class="main-title">Citi Bike Data Analysis</div>
			<div>
				<ul class="navlist">
					<li class="first">Users</li>
					<li>Genders</li>
					<li>Trips</li>
					<li>Weather</li>
				</ul>
			</div>
			<div class="chart-title">Customer Subscriber Distribution</div>
		</div>
		<div id="content">
			<div id="chart-container" class="sixty space">
				<canvas id="canvas"></canvas>
			</div>					
			<div id="dataset" class="forty space">
				<table id="chart-table">
					<tbody></tbody>
				</table>â€‹
			</div>
		</div>
		<div id="footer">
			<div>
				<ul class="navlist">
					<li class="first">Users</li>
					<li>Genders</li>
					<li>Trips</li>
					<li>Weather</li>
				</ul>
			</div>	
		</div>
	</div>
</body>
</html>