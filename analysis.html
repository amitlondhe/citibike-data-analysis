<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
	<meta charset="UTF-8">
	<!-- <script src="http://code.jquery.com/jquery-1.11.2.min.js"></script> -->
	<script src="js/jquery.js"></script>
	<script src="js/Chart.min.js"></script>
	<link href="css/my.css" rel="stylesheet">
	<title>IBM Big Data Challenge</title>
	<script>
 		var pieChartData = [
			//"Customer",1150379,"Subscriber",8574247
			{
		        value: 1150379,
		        color:"#F7464A",
		        highlight: "#FF5A5E",
		        label: "Customer"
		    },
		    {
		        value: 8574247,
		        color: "#46BFBD",
		        highlight: "#5AD3D1",
		        label: "Subscriber"
		    }
		];
		
		subscriberData = [
					//"Male",83 "Unknown",1150282 "Female",14
					{
				        value: 6587739,
				        color:"Blue",
				        highlight: "Blue",
				        label: "Male"
				    },
					{
				        value: 1985582,
				        color:"Deeppink",
				        highlight: "Deeppink",
				        label: "Female"
				    },
					{
				        value: 926,
				        color:"grey",
				        highlight: "darkgrey",
				        label: "Unknown"
					}
		];

		customerData = [
					//"Male",83 "Unknown",1150282 "Female",14
					{
				        value: 83,
				        color:"Blue",
				        highlight: "Blue",
				        label: "Male"
				    },
					{
				        value: 14,
				        color:"Deeppink",
				        highlight: "Deeppink",
				        label: "Female"
				    },
					{
				        value: 1150282,
				        color:"grey",
				        highlight: "darkgrey",
				        label: "Unknown"
				    }
		];		
				
		$(document).ready(function(){
		
			var ctx = document.getElementById("canvas").getContext("2d");
			renderPieChart(pieChartData);
			createTableForPieChart(pieChartData,"UserTypeDistribution");
			
			function renderPieChart(pieChartData) {
				myPieChart = new Chart(ctx).Pie(pieChartData, {
					responsive : true,
					animateScale : true,
				});
			}
			
			
			canvas.onclick = function(evt){
		 		var activePoints = myPieChart.getSegmentsAtEvent(evt);
		 		console.log("label clicked " + activePoints[0].label);
		 		if("Customer" == activePoints[0].label) {
		 			myPieChart.destroy();
		 			console.log("Rendering gender distribution for Customers");
		 			renderPieChart(customerData);
					createTableForPieChart(customerData,"GenderDistribution");
					updateChartTitle("Gender Distribution For Customers");
		 		} else if("Subscriber" == activePoints[0].label)  {
		 			myPieChart.destroy();
		 			console.log("Rendering gender distribution for Subscriber");
		 			renderPieChart(subscriberData);
		 			createTableForPieChart(subscriberData,"GenderDistribution");
		 			updateChartTitle("Gender Distribution For Subscribers");
		 		} else {
		 			return;
		 		}
			};
			
			function createTableForPieChart(pieChartData,pieChartFor) {
				var tbody  = $('#chart-table > tbody');
				var rows = $('#chart-table > tbody > tr')
				console.log("rows.length" + rows.length);
				for(i=0;i<rows.length;i++) {
					rows[i].remove();
				}
				if(pieChartFor == "UserTypeDistribution") {
					tbody.append("<tr class='pie-table-header'><td>Key</td><td>User Type</td><td># of Trips</td></tr>");
				} else if(pieChartFor == "GenderDistribution") {
					tbody.append("<tr class='pie-table-header'><td>Key</td><td>Gender</td><td># of Trips</td></tr>");
				}
				console.log("elements in Pie Chart - " + pieChartData.length);
				for(i=0;i< pieChartData.length;i++) {
					title = pieChartData[i].label;
					value = pieChartData[i].value;
					tbody.append("<tr class='pie-table-row'><td><div class=\"colorbox "+ title.toLowerCase() + "\"></div></td><td>"+title+"</td><td>"+value+"</td></tr>");
				}
			}
			
			function updateChartTitle(chartTitle) {
				$("#header > span").last().text(chartTitle);
			}
		});	 
	</script>
</head>
<body>
	<div id="container">
		<div id="header" class="header">
			<span>Citi Bike Data Analysis</span><br/>
			<span class="chart-title">Customer Subscriber Distribution</span>
		</div>
		<div id="content">
			<div id="chart-container" class="sixty space">
				<canvas id="canvas"></canvas>
			</div>					
			<div id="dataset" class="forty space">
				<table id="chart-table">
					<tbody></tbody>
				</table>â€‹
			</div>
		</div>
		<div id="footer">
			<div id="nav">
				<a id="UserTypeDistribution" href="#">UserTypeDistribution</a>
			</div>			
		</div>
	</div>
</body>
</html>